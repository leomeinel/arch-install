#!/usr/bin/env bash
###
# File: upgrade-packages
# Author: Leopold Meinel (leo@meinel.dev)
# -----
# Copyright (c) 2025 Leopold Meinel & contributors
# SPDX ID: MIT
# URL: https://opensource.org/licenses/MIT
# -----
###

# Fail on error
set -e

# Define functions
log_err() {
    /usr/bin/logger -s -p local0.err <<<"$(basename "${0}"): ${*}"
}

# If current user is not in group wheel, don't do anything
if id -nG "${UID}" | grep -vwq "wheel"; then
    log_err "You can only run this script if you are in group 'wheel'."
    exit 1
fi

# Upgrade paru
/usr/bin/paru

# Upgrade flatpak
exec /usr/bin/doas /usr/bin/flatpak --system update
